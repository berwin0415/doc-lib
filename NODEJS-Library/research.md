# Nodejs 中间层

## 为什么需要

### [我们为什么需要 Node 中间层](https://juejin.im/post/5c09db2fe51d4573802ab995)

在前后端分离的天然选择下，node 中间层可以承担更多的责任。

- 代理：在开发环境下，我们可以利用代理来，解决最常见的跨域问题；在线上环境下，我们可以利用代理，转发请求到多个服务端。
- 缓存：缓存其实是更靠近前端的需求，用户的动作触发数据的更新，node 中间层可以直接处理一部分缓存需求。
- 限流：node 中间层，可以针对接口或者路由做响应的限流。
- 日志：相比其他服务端语言，node 中间层的日志记录，能更方便快捷的定位问题（是在浏览器端还是服务端）。
- 监控：擅长高并发的请求处理，做监控也是合适的选项。
- 鉴权：有一个中间层去鉴权，也是一种单一职责的实现。
- 路由：前端更需要掌握页面路由的权限和逻辑。
- 服务端渲染：node 中间层的解决方案更灵活，比如 SSR、模板直出、利用一些 JS 库做预渲染等等。
- 更多的可能性

### [node中间层的作用](https://www.zhihu.com/question/59076103/answer/215693374)

1. 服务端只负责吞吐数据，减少服务端修改数据结构的情况，数据结构的解析放到前端开发人员身上
2. 在数据量过大或步骤繁琐通信频繁的时候，考虑到前端性能或者前端网络稳定情况，可以将多个请求与数据量较大的处理过程放到Nodejs 中间层去处理
3. UI 与数据模型的解耦

### [为什么要用node做中间层？](https://zhuanlan.zhihu.com/p/75843905)

#### 现有开发阶段出现的问题。

1. 前后端职责不清。在传统的不分离模式中，我们看到一大堆复杂逻辑的前后端混杂在一起的代码会异常头疼，有的时候完全没法维护。虽然前后端分离能缓解这种问题，因为从物理层方面决定了不可能把前后端代码携带一起，但是治标不治本。
2. 开发效率问题。在第一个问题影响开发效率的基础上，再说几个影响前后端开发效率的事。淘宝的web基本上都是基于MVC框架webx，决定了前端的职责还是写好静态demo，由后端翻译。传统前后端分离的模式中，后端也需要根据前端需要的数据模型进行返回(比如排序、筛选等),后端也没法摆脱展现的问题，专注以逻辑层的开发。
3. SEO优化问题。虽然现在百度已经跌下神坛，很多公司已经不太重视seo优化了，而且我们也不指望一头凉水能浇醒李彦宏，但是很多需要从百度等搜索引擎引流的公司来说，seo优化不可谓不重要。但是传统的前后端分离模式通过ajax取回数据再渲染页面的做法对seo并不友好。而且谷歌公司也明确不会做谷歌中国。



## 业界现状

### [众安在线](https://www.zhihu.com/question/329721275/answer/719135406)

1. 微信生态产品: 服务号(模板消息、自定义分享等)、小程序(服务通知、微信支付)、开放平台(第三方网站扫码登录)；
2. 辅助业务: 完善的运维监控系统、强大的管理系统、全面的统计报表、各类图片生成工具(带渠道参数二维码、带用户信息的小程序码)；
3. 最近几个月还接入了字节跳动小程序、蚂蚁金服小程序、百度智能小程序，且全部运行良好；

## 面临的问题

1. 前端对接多个后端，接口分散
2. C端产品需要降低首屏白屏时间，提升体验
3. 接口性能监控

## 解决方案

[BFF —— Backend For Frontend](https://www.jianshu.com/p/eb1875c62ad3)\

[最小而美的Egg + React + SSR 服务端渲染应用骨架](https://github.com/ykfe/egg-react-ssr)